We have a site where there is a document content type, for ease of editing and
upload. There is a bit of behind the scenes code to make the nodes and links to
those nodes behave as links to files. Here's some of those functions:

```
/**
 * Callback function for document download menu path.
 *
 * @param object $nid
 *   The nid of the document to download.
 */
function intuit_document_document_file($nid) {
  // Verify that we have a numeric nid value.
  if (!is_numeric($nid)) {
    return drupal_not_found();
  }
  // Get the document node.
  $query = new EntityFieldQuery();
  $query->entityCondition('entity_type', 'node')
    ->entityCondition('bundle', INTUIT_DOCUMENT_FILE_NODE_TYPE)
    ->propertyCondition('status', 1)
    ->propertyCondition('nid', $nid)
    ->fieldCondition(INTUIT_DOCUMENT_FILE_NODE_FIELD, 'fid', 'NULL', '!=')
    ->addMetaData('account', user_load(1));
  $result = $query->execute();
  // Verify that results were found.
  if (isset($result['node'])) {
    $document_nids = array_keys($result['node']);
    $document_nodes = entity_load('node', $document_nids);
    $document = array_pop($document_nodes);
  }
  // Verify that a Document node was found.
  if ($document->nid) {
    // Get the file field data.
    $file = field_get_items('node', $document, INTUIT_DOCUMENT_FILE_NODE_FIELD);
    // Cast the file to a file object.
    $file = (object) $file[0];
    // Get the HTTP headers for the file.
    $headers = file_download_headers($file->uri);
    // Set the file name.
    $headers['Content-Disposition'] = sprintf('attachment; filename=%s', $file->filename);
    // Download the file.
    file_transfer($file->uri, $headers);
  }
  // Fallback behavior.
  return drupal_not_found();
}

/**
 * Implements template_preprocess_node().
 */
function intuit_document_preprocess_field(&$variables) {
  if ($variables['element']['#field_name'] === 'field_document_plan') {
    $number_of_terms = count($variables['items']);
    foreach ($variables['items'] as $key => $item) {
      if ($key < $number_of_terms - 1) {
        $variables['items'][$key]['#suffix'] = ', ';
      }
    }
  }
}

/**
 * Implements hook_views_pre_view().
 */
function intuit_document_views_pre_view(&$view, &$display_id, &$args) {
  // Document View.
  if ($view->name == 'document') {
    // Document Listing blocks.
    if (in_array($display_id, array('document_listing', 'document_listing_form'))) {
      // Get the current node.
      $node = menu_get_object();
      // Verify that we are on a Page node.
      if ($node && $node->type == 'page') {
        // Verify that a country nid value was set.
        if (!empty($node->field_page_country[LANGUAGE_NONE][0]['target_id'])) {
          // Get the country nid.
          $country_nid = $node->field_page_country[LANGUAGE_NONE][0]['target_id'];
          // Add the country nid as the contextual filter.
          $view->args[0] = $country_nid;
        }
      }
    }
  }
}

/**
 * Implements hook_form_alter().
 */
function intuit_document_form_alter(&$form, &$form_state, $form_id) {
  // Only USA needs the Provider dropdown.
  if ($form_id == 'views_exposed_form' && $form_state['view']->name == 'document' && $form['#id'] == 'views-exposed-form-document-document-listing') {
    if ($node = menu_get_object()) {
      if (!empty($node->field_page_country[LANGUAGE_NONE][0]['target_id'])) {
        // Get the country nid.
        $country_nid = $node->field_page_country[LANGUAGE_NONE][0]['target_id'];

        if ($country_nid != INTUIT_DOCUMENT_COUNTRY_NID_US) {
          unset($form['#info']['filter-field_document_carrier_tid']);
          $form['field_document_carrier_tid'] = array(
            '#type' => 'hidden',
            '#value' => 'All',
          );
        }
      }
    }
  }
}

/**
 * Implements hook_url_outbound_alter().
 */
function intuit_document_url_outbound_alter(&$path, &$options, $original_path) {
  // Only figure out document nodes once.
  static $document_nodes;

  // If we don't have any, we need some.
  if (!count($document_nodes)) {
    $query = "SELECT nid FROM {node} WHERE type = 'document' AND status = 1";
    $result = db_query($query);
    // Just the nids, nothing else is required.
    $document_nodes = array_keys($result->fetchAllAssoc('nid'));
  }

  // Create the new path.
  $nid = str_replace('node/', '', $original_path);

  // If this is a document node, and if we have a node id.
  if (is_numeric($nid) && in_array($nid, $document_nodes)) {
    // Build the new path.
    $path = url('document/' . $nid);

    // url() appropriate options.
    $options['absolute'] = TRUE;
    $options['alias'] = TRUE;
    $options['attributes'] = array(
      'target' => '_blank',
    );
  }
}
```
